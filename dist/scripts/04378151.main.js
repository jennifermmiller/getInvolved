var EventClass=Parse.Object.extend("EventClass"),CommentClass=Parse.Object.extend("CommentClass",{defaults:{commentBy:"Anonymous"}}),VolunteerClass=Parse.Object.extend("VolunteerClass"),EventsCollection=Parse.Collection.extend({model:EventClass}),CommentsCollection=Parse.Collection.extend({model:CommentClass}),VolunteersCollection=Parse.Collection.extend({model:VolunteerClass}),Router=Backbone.Router.extend({routes:{"":"home",about:"aboutPage",getHelp:"getHelpPage",helpOut:"helpOutPage","helpOut/:location/:day":"sortEvents","helpOut/:eventId":"eventDetails"},initialize:function(){this.events=new EventsCollection,this.comments=new CommentsCollection,this.volunteers=new VolunteersCollection},home:function(){$("body").empty(),new HeaderView,new HomeView;var a=new Parse.Query(EventClass),b=moment().format();a.greaterThan("eventDate",b),a.limit(6),a.ascending("eventDate"),a.find({success:function(a){for(var b=0;b<a.length;b++)new ThumbnailView({model:a[b]});new FooterView},error:function(){console.log("not so fast!")}})},aboutPage:function(){$("body").empty(),new HeaderView,new AboutView,new FooterView},getHelpPage:function(){$("body").empty(),new HeaderView,new GetHelpView,new FooterView},helpOutPage:function(){$("body").empty(),new HeaderView,new HelpOutView,new FooterView},sortEvents:function(a,b){if("any"===a){var c=new Parse.Query(EventClass);c.equalTo("eventDate",b),c.find({success:function(a){if($(".opportunities").empty(),a.length>0)for(var b=0;b<a.length;b++)new ThumbnailView({model:a[b]});else $(".opportunities").append('<h3 class="no-results">Sorry, no reults found.</h3>')},error:function(){console.log("Bad Bad stuff!")}})}else if("any"===b){var c=new Parse.Query("EventClass");c.equalTo("city",a),c.find({success:function(a){if($(".opportunities").empty(),a.length>0)for(var b=0;b<a.length;b++)new ThumbnailView({model:a[b]});else $(".opportunities").append('<h3 class="no-results">Sorry, no reults found.</h3>')},error:function(){console.log("Bad Bad stuff!")}})}else{var d=new Parse.Query("EventClass");d.equalTo("city",a);var e=new Parse.Query("EventClass");e.equalTo("eventDate",b);var f=Parse.Query.or(d,e);f.find({success:function(a){if($(".opportunities").empty(),a.length>0)for(var b=0;b<a.length;b++)new ThumbnailView({model:a[b]});else $(".opportunities").append('<h3 class="no-results">Sorry, no reults found.</h3>')}})}},eventDetails:function(a){$("body").empty(),new HeaderView;var b=this;this.events.fetch({success:function(){var c=b.events.get(a);new EventView({model:c});var d=new Parse.Query(CommentClass);d.equalTo("parent",c),d.ascending("createdAt"),d.find({success:function(a){$("#no-comments").hide(),_.each(a,function(a){new CommentView({model:a})}),new FooterView},error:function(){console.log("Cannot load comments.")}})},error:function(){console.log("Cannot load event.")}})}}),HeaderView=Backbone.View.extend({tagName:"header",createTemplate:_.template($("#header-template").text()),initialize:function(){$("body").prepend(this.el),this.render()},render:function(){this.$el.html(this.createTemplate())}}),FooterView=Backbone.View.extend({tagName:"footer",className:"footer",createTemplate:_.template($("#footer-template").text()),initialize:function(){$("body").append(this.el),this.render()},render:function(){this.$el.html(this.createTemplate())}}),HomeView=Backbone.View.extend({className:"homepage-guts",createTemplate:_.template($("#home-template").text()),initialize:function(){$("body").append(this.el),this.render()},render:function(){this.$el.html(this.createTemplate())}}),ThumbnailView=Backbone.View.extend({tagName:"a",className:"thumbnails",createTemplate:_.template($("#thumbnail-template").text()),initialize:function(){$(".opportunities").append(this.el),this.setHrefAttr(),this.render()},render:function(){this.$el.html(this.createTemplate({model:this.model}))},setHrefAttr:function(){var a=this.model.id,b="#/helpOut/"+a;this.$el.attr({href:b})}}),AboutView=Backbone.View.extend({createTemplate:_.template($("#about-template").text()),initialize:function(){$("body").append(this.el),this.render()},render:function(){this.$el.html(this.createTemplate())}}),GetHelpView=Backbone.View.extend({className:"get-help",createTemplate:_.template($("#get-help-template").text()),events:{"click #submit-help-form":"submit"},initialize:function(){$("body").append(this.el),this.render()},render:function(){this.$el.html(this.createTemplate()),$("#event-name").focus()},submit:function(){var a=new EventClass;if($("#event-photo").val()!==[]){var b=$("#event-photo")[0];if(b.files.length>0)var c=b.files[0],d="photo.jpg",e=new Parse.File(d,c);e.save().then(function(){console.log("Youre awesome pic has been saved")},function(){console.log("Oops! Couldnt save your photo")})}var f=$("#event-date").val(),g=moment(f).format("MMM Do"),h=moment(f).format("MMMM Do YYYY");a.set("eventPhoto",e),a.set("eventName",$("#event-name").val()),a.set("eventDescription",$("#event-description").val()),a.set("eventDate",f),a.set("eventDateThumbnail",g),a.set("eventDateFull",h),a.set("eventStart",$("#start-event").val()),a.set("eventDuration",parseInt($("#event-duration").val())),a.set("eventSponsor",$("#event-sponsor").val()),a.set("email",$("#sponsor-email").val()),a.set("peopleWanted",parseInt($("#needed-vols").val()));var i=new google.maps.Geocoder,j=$("#event-address").val();i.geocode({address:j},function(b,c){if(c==google.maps.GeocoderStatus.OK){var d=b[0].address_components[2].long_name.toLowerCase(),e=b[0].address_components[2].long_name,f=b[0].geometry.location.lng(),g=b[0].geometry.location.lat();console.log(g,f,d),a.set("longitude",f),a.set("latitude",g),a.set("city",d),a.set("eventLocation",e),a.set("eventAddress",j)}else console.log("The Google gods frown upon you!"+c)}),a.save(),router.events.add(a)}}),HelpOutView=Backbone.View.extend({createTemplate:_.template($("#help-out-template").text()),className:"help-out-view",events:{"click .search-options":"showSearch","click #search-btn":"search"},initialize:function(){$("body").append(this.el);var a=new Parse.Query("EventClass"),b=moment().format();a.greaterThan("eventDate",b),a.descending("createdAt"),a.find({success:function(a){_.each(a,function(a){new ThumbnailView({model:a})})}}),this.render()},render:function(){this.$el.html(this.createTemplate())},showSearch:function(){$(".expand-search").show()},search:function(){if(""!==$("#desired-location").val()&&""!==$("#desired-date").val())var a=$("#desired-location").val().toLowerCase(),b=$("#desired-date").val();else if(""===$("#desired-location").val()&&""!==$("#desired-date").val())var a="any",b=$("#desired-date").val();else if(""!==$("#desired-location").val()&&""===$("#desired-date").val())var a=$("#desired-location").val().toLowerCase(),b="any";var c="#/helpOut/"+a+"/"+b;this.$el.find("#search-btn").attr("href",c),console.log("what the shit"),$("#desired-location").val(""),$("#desired-date").val("")}}),EventView=Backbone.View.extend({className:"event-focus",createTemplate:_.template($("#event-template").text()),events:{"click #signup":"signMeUp","click #add-comment-btn":"addComment"},initialize:function(){$("body").append(this.el),this.render(),console.log(this.model.id);var a=this.model.get("latitude"),b=this.model.get("longitude"),c=new google.maps.LatLng(a,b),d={zoom:16,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP},e=new google.maps.Map(document.getElementById("map-canvas"),d),f={position:new google.maps.LatLng(a,b)},g=new google.maps.Marker(f);g.setMap(e);var h=this.model.get("peopleWanted");1>h&&$("#volunteer").prop("disabled",!0)},render:function(){this.$el.html(this.createTemplate({model:this.model}))},signMeUp:function(){{var a=new VolunteerClass;this.model.get("peopleWanted")}if(""!==$("#volunteer-name").val()&&""!==$("#volunteer-email").val()){var b=$("#volunteer-name").val(),c=$("#volunteer-email").val(),d=$("#volunteer-extra").val();a.set("name",b),a.set("email",c),a.set("extraInfo",d),a.set("parent",this.model),router.volunteers.add(a);var e=this;a.save(null,{success:function(){var a=new Parse.Query("EventClass");a.get(e.model.id,{success:function(a){a.increment("peopleWanted",-1),a.save()}}),$("#myModal").hide(),$(".modal-backdrop").hide()},error:function(a,b){console.log("Opps! "+b+"just happened")}}),$("#volunteer-name").val(""),$("#volunteer-email").val(""),$("#volunteer-extra").val("")}},addComment:function(){var a=$("#new-comment").val();if(""!==a){var b=new CommentClass,c=moment().format("MMM Do YYYY, h:mm a");if(b.set("commentContent",a),""!==$("#comment-by").val()){var d=$("#comment-by").val();b.set("commentBy",d)}b.set("commentedAt",c),b.set("parent",this.model),router.comments.add(b),b.save(null,{success:function(a){new CommentView({model:a}),$("#new-comment").val(""),$("#comment-by").val("")},error:function(a,b){console.log("No one wants to hear from the peanut gallery. "+b)}})}}}),CommentView=Backbone.View.extend({tagName:"li",createTemplate:_.template($("#comment-template").text()),initialize:function(){$(".prev-comments").prepend(this.el),this.render()},render:function(){this.$el.html(this.createTemplate())}});$(document).ready(function(){Parse.initialize("BVqqHnDg3xhdBezKMQFxvzdjHx98lJDRJxjCJy9H","9HXAYhUbtdZsRREtIp9K7YChpvAFAeWsTBZAYkPt"),window.router=new Router,Backbone.history.start()});